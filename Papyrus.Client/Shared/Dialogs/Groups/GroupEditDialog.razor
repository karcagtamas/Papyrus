@using KarcagS.Shared.Helpers
@using Papyrus.Client.Services.Groups.Interfaces
@using Papyrus.Shared.DTOs.Groups
@using Papyrus.Shared.Models.Groups
@inject IStringLocalizer<GroupEditDialog> L

<EditorDialog Model="GroupModel" ModelObj="Model" Submit="Submit" EntityName="@L["Entity"]" IsEdit="IsEdit">
    <MudTextField T="string" Label="@L["Field.Name"]" Variant="Variant.Text" Required="true"
                  For="@(() => Model.Name)" @bind-Value="Model.Name" FullWidth="true" />
</EditorDialog>

@code {
    [Parameter]
    public int? GroupId { get; set; }

    [Inject]
    private IGroupService GroupService { get; set; } = default!;

    private GroupListDTO? Group { get; set; }
    private GroupModel Model { get; set; } = new();
    private bool IsEdit { get; set; } = false;

    protected override async void OnInitialized()
    {
        if (ObjectHelper.IsNotNull(GroupId))
        {
            IsEdit = true;
            Group = await GroupService.Get<GroupListDTO>((int)GroupId);

            if (ObjectHelper.IsNotNull(Group))
            {
                Model = new GroupModel
                    {
                        Name = Group.Name
                    };
                await InvokeAsync(StateHasChanged);
            }
        }
        base.OnInitialized();
    }

    private Task<bool> Submit()
    {
        if (IsEdit && ObjectHelper.IsNotNull(GroupId))
        {
            return GroupService.Update((int)GroupId, Model);
        }

        return GroupService.Create(Model);
    }
}
