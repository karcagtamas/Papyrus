@using Papyrus.Client.Services.Notes.Interfaces
@using Papyrus.Shared.DTOs.Groups
@using Papyrus.Shared.DTOs.Notes
@inject IStringLocalizer<TagTreeSelectorDialog> L

<TreeSelectorDialog TKey="int" T="TagTreeItemDTO" EntityName="@L["Entity"]" BodyText="@L["BodyText"]" Fetcher="@Fetcher" ItemExtractor="@ItemExctractor" TitleGetter="@TitleGetter" MultiSelect="MultiSelect" DisabledIds="AllDisabledIds" />

@code {
    [Parameter]
    public int? GroupId { get; set; }

    [Parameter]
    public int? ParentId { get; set; }

    [Parameter]
    public int? CurrentId { get; set; }

    [Parameter]
    public List<int> DisabledIds { get; set; } = new();

    [Parameter]
    public bool MultiSelect { get; set; }

    [Inject]
    private ITagService TagService { get; set; } = default!;

    private List<int> AllDisabledIds { get => ObjectHelper.IsNull(ParentId) ? DisabledIds : DisabledIds.Concat(new List<int> { (int)ParentId }).ToList(); }

    private Task<List<TagTreeItemDTO>> Fetcher() => TagService.GetTree(GroupId, CurrentId);

    private List<TagTreeItemDTO> ItemExctractor(TagTreeItemDTO obj) => obj.Children;

    private string TitleGetter(TagTreeItemDTO obj) => obj.Caption;
}