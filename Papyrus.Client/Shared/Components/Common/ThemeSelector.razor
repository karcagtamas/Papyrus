@using Papyrus.Client.Services.Interfaces
@using Papyrus.Shared.Enums
@using KarcagS.Blazor.Common.Store
@inject NavigationManager Navigator
@inject IStoreService StoreService
@inject ICommonService CommonService

<MudMenu Label="@Current.ToString()" Color="Color" Variant="Variant" Dense="true" StartIcon="@Icons.Filled.Language" EndIcon="@Icons.Filled.KeyboardArrowDown" DisableElevation="true" AnchorOrigin="Origin.BottomLeft" TransformOrigin="Origin.TopLeft">
    @foreach (var theme in Themes)
    {
        <MudMenuItem OnClick="@(() => UpdateTheme(theme))"><MudText Color="@(Current == theme ? Color.Primary : Color.Default)">@(theme.ToString())</MudText></MudMenuItem>
    }
</MudMenu>

@code {
    [Parameter]
    public Color Color { get; set; } = Color.Primary;

    [Parameter]
    public Variant Variant { get; set; } = Variant.Filled;

    private List<Theme> Themes { get; set; } = new();
    private Theme Current { get; set; } = Theme.Light;

    protected override async void OnInitialized()
    {
        base.OnInitialized();
        Themes = new List<Theme> { Theme.Light, Theme.Dark };

        var theme = StoreService.Get<int>("theme");

        if (theme != (int)Theme.Light && theme != (int)Theme.Dark)
        {
            await CommonService.SetLocalTheme((int)Theme.Light);
        }

        Current = (Theme)theme;

        StateHasChanged();
    }

    private async Task UpdateTheme(Theme theme)
    {
        await CommonService.SetLocalTheme((int)theme);
    }
}
