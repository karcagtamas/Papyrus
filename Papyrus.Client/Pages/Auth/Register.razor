@page "/register"
@using KarcagS.Shared.Helpers
@using Papyrus.Shared.Models.Auth
@using Papyrus.Client.Services.Auth.Interfaces
@layout AuthLayout
@inject NavigationManager navigationManager
@inject IAuthService authService
@inject IStringLocalizer<Register> L

<ApplicationPageTitle PageName="@L["PageName"]"></ApplicationPageTitle>

<div id="panel">
    <MudPaper Class="p-4" Elevation="4">
        <MudText Typo="Typo.h4" Color="Color.Primary">@L["Title"]</MudText>

        <MainImage Width="300" Class="mt-3 text-center" />

        <MudForm @ref="form">
            <MudTextField T="string" Label="@L["Field.UserName"]" Variant="Variant.Text" Required="true"
                          For="@(() => Model.UserName)" @bind-Value="Model.UserName" FullWidth="true">
            </MudTextField>
            <MudTextField T="string" Label="@L["Field.Email"]" Variant="Variant.Text" Required="true" For="@(() => Model.Email)"
                          @bind-Value="Model.Email" FullWidth="true">
            </MudTextField>
            <MudTextField T="string" Label="@L["Field.Password"]" Variant="Variant.Text" InputType="@passwordInput"
                          Adornment="Adornment.End" AdornmentIcon="@passwordInputIcon" OnAdornmentClick="SwitchPasswordVisibility"
                          Required="true" For="@(() => Model.UserName)" @bind-Value="Model.Password" FullWidth="true">
            </MudTextField>
            <MudTextField T="string" Label="@L["Field.FullName"]" Variant="Variant.Text" For="@(() => Model.FullName)"
                          @bind-Value="Model.FullName" FullWidth="true">
            </MudTextField>
            <div class="text-center mt-3 mb-3">
                <MudButton Color="Color.Primary" Class="mt-3" Variant="Variant.Filled" OnClick="Submit"
                           StartIcon="@Icons.Material.Filled.PersonAdd">
                    @L["Button"]
                </MudButton>
            </div>
            <MudDivider />
            <div class="text-center mt-3">
                <MudButton Color="Color.Secondary" Variant="Variant.Text" OnClick="ToLogin"
                           StartIcon="@Icons.Material.Filled.Login">@L["Redirect"]</MudButton>
            </div>
        </MudForm>
    </MudPaper>
</div>

@code {
    MudForm? form;

    private RegistrationModel Model { get; set; } = new();

    private bool isShow;
    private string passwordInputIcon = Icons.Material.Filled.VisibilityOff;
    private InputType passwordInput = InputType.Password;

    private async void Submit()
    {
        if (ObjectHelper.IsNull(form))
        {
            return;
        }

        await form.Validate();
        if (!form.IsValid) return;
        if (await authService.Register(Model))
        {
            navigationManager.NavigateTo("/login");
        }
    }

    private void ToLogin()
    {
        navigationManager.NavigateTo("/login");
    }

    private void SwitchPasswordVisibility()
    {
        if (isShow)
        {
            isShow = false;
            passwordInputIcon = Icons.Material.Filled.VisibilityOff;
            passwordInput = InputType.Password;
        }
        else
        {
            isShow = true;
            passwordInputIcon = Icons.Material.Filled.Visibility;
            passwordInput = InputType.Text;
        }
    }

}
